{% extends "base_premium.html" %}

{% block title %}Donor Appointments - BloodBank Pro{% endblock %}

{% block content %}
<div class="mb-6">
    <h1 style="font-size: 1.875rem; font-weight: 700; color: var(--text-primary); margin-bottom: var(--space-2);">
        Donor Appointments
    </h1>
    <p style="color: var(--text-secondary); font-size: 1rem;">
        Manage donor appointment requests and approvals
    </p>
</div>

{% with messages = get_flashed_messages(with_categories=true) %}
    {% if messages %}
        {% for category, message in messages %}
            <div class="alert-premium alert-{{ 'danger' if category == 'error' else category }} mb-6">
                {{ message }}
            </div>
        {% endfor %}
    {% endif %}
{% endwith %}

<!-- Statistics Cards -->
{% if appointments %}
<div class="grid grid-cols-4 gap-6 mb-6">
    <div class="stat-card-premium animate-fade-in">
        <div class="stat-icon-premium">
            <i class="bi bi-clock"></i>
        </div>
        <div class="stat-number-premium">{{ appointments|selectattr('status', 'equalto', 'Pending')|list|length }}</div>
        <div class="stat-label-premium">Pending</div>
    </div>
    
    <div class="stat-card-premium animate-fade-in" style="animation-delay: 0.1s;">
        <div class="stat-icon-premium">
            <i class="bi bi-check-circle"></i>
        </div>
        <div class="stat-number-premium">{{ appointments|selectattr('status', 'equalto', 'Approved')|list|length }}</div>
        <div class="stat-label-premium">Approved</div>
    </div>
    
    <div class="stat-card-premium animate-fade-in" style="animation-delay: 0.2s;">
        <div class="stat-icon-premium">
            <i class="bi bi-gem"></i>
        </div>
        <div class="stat-number-premium">{{ appointments|selectattr('is_rare_donor', 'equalto', 1)|list|length }}</div>
        <div class="stat-label-premium">Rare Donors</div>
    </div>
    
    <div class="stat-card-premium animate-fade-in" style="animation-delay: 0.3s;">
        <div class="stat-icon-premium">
            <i class="bi bi-calendar-day"></i>
        </div>
        <div class="stat-number-premium">{{ appointments|list|length }}</div>
        <div class="stat-label-premium">Total Requests</div>
    </div>
</div>
{% endif %}

<!-- Appointments Table -->
<div class="card-premium animate-fade-in" style="animation-delay: 0.4s;">
    <div class="card-header-premium">
        <h2 class="card-title">
            <i class="bi bi-calendar-check"></i>
            Appointment Requests
        </h2>
    </div>
    <div class="card-body-premium">
        {% if appointments %}
            <div style="overflow-x: auto;">
                <table class="table-premium">
                    <thead>
                        <tr>
                            <th>Donor Name</th>
                            <th>Blood Group</th>
                            <th>Phone</th>
                            <th>City</th>
                            <th>Preferred Time</th>
                            <th>Status</th>
                            <th>Special</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for appointment in appointments %}
                        <tr>
                            <td>
                                <div style="font-weight: 600; color: var(--text-primary);">{{ appointment.name }}</div>
                                {% if appointment.is_rare_donor %}
                                    <div style="font-size: 0.75rem; color: var(--warning); margin-top: var(--space-1);">
                                        <i class="bi bi-star-fill"></i> Rare Donor
                                    </div>
                                {% endif %}
                            </td>
                            <td>
                                <span class="badge-premium badge-danger">{{ appointment.blood_group }}</span>
                                {% if appointment.blood_group in ['AB-', 'B-', 'O-'] %}
                                    <div style="font-size: 0.75rem; color: var(--warning); margin-top: var(--space-1);">Rare Type</div>
                                {% endif %}
                            </td>
                            <td>
                                <a href="tel:{{ appointment.phone }}" style="color: var(--accent-red); text-decoration: none; font-family: monospace;">
                                    <i class="bi bi-telephone"></i> {{ appointment.phone }}
                                </a>
                            </td>
                            <td style="color: var(--text-secondary);">{{ appointment.city }}</td>
                            <td>
                                <div style="font-weight: 600; color: var(--text-primary);">{{ appointment.preferred_time.strftime('%m/%d/%Y') }}</div>
                                <div style="font-size: 0.875rem; color: var(--text-secondary);">{{ appointment.preferred_time.strftime('%I:%M %p') }}</div>
                            </td>
                            <td>
                                {% if appointment.status == 'Pending' %}
                                    <span class="badge-premium badge-warning">
                                        <i class="bi bi-clock"></i> Pending
                                    </span>
                                {% elif appointment.status == 'Approved' %}
                                    <span class="badge-premium badge-success">
                                        <i class="bi bi-check-circle"></i> Approved
                                    </span>
                                {% elif appointment.status == 'Rejected' %}
                                    <span class="badge-premium badge-danger">
                                        <i class="bi bi-x-circle"></i> Rejected
                                    </span>
                                {% else %}
                                    <span class="badge-premium badge-info">
                                        <i class="bi bi-check2-all"></i> Completed
                                    </span>
                                {% endif %}
                            </td>
                            <td>
                                {% if appointment.is_rare_donor %}
                                    <span class="badge-premium" style="background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%); color: #1a1a1a; animation: pulse 2s infinite;">
                                        <i class="bi bi-gem"></i> RARE
                                    </span>
                                {% endif %}
                            </td>
                            <td>
                                {% if appointment.status == 'Pending' %}
                                    <div style="display: flex; gap: var(--space-2);">
                                        <a href="{{ url_for('approve_appointment', appointment_id=appointment.appointment_id) }}" 
                                           class="btn-premium btn-success-premium btn-sm"
                                           onclick="return confirm('Approve this appointment?')">
                                            <i class="bi bi-check"></i> Approve
                                        </a>
                                        <a href="{{ url_for('reject_appointment', appointment_id=appointment.appointment_id) }}" 
                                           class="btn-premium btn-danger-premium btn-sm"
                                           onclick="return confirm('Reject this appointment?')">
                                            <i class="bi bi-x"></i> Reject
                                        </a>
                                    </div>
                                {% else %}
                                    <span style="color: var(--text-muted);">No actions</span>
                                {% endif %}
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        {% else %}
            <div class="text-center" style="padding: var(--space-8);">
                <i class="bi bi-calendar-x" style="font-size: 4rem; color: var(--text-muted); margin-bottom: var(--space-4);"></i>
                <p style="color: var(--text-secondary); margin-bottom: var(--space-2);">No appointment requests found</p>
                <p style="color: var(--text-muted);">Donors will see your hospital when they select your city for donations.</p>
            </div>
        {% endif %}
    </div>
</div>

<style>
@keyframes pulse {
    0% { transform: scale(1); }
    50% { transform: scale(1.05); }
    100% { transform: scale(1); }
}

.btn-success-premium {
    background: linear-gradient(135deg, #22c55e 0%, #16a34a 100%);
    border: none;
    color: white;
    padding: var(--space-2) var(--space-3);
    border-radius: var(--radius);
    font-size: 0.875rem;
    font-weight: 500;
    transition: all 0.3s ease;
}

.btn-success-premium:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(34, 197, 94, 0.3);
    color: white;
}

.btn-danger-premium {
    background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
    border: none;
    color: white;
    padding: var(--space-2) var(--space-3);
    border-radius: var(--radius);
    font-size: 0.875rem;
    font-weight: 500;
    transition: all 0.3s ease;
}

.btn-danger-premium:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(239, 68, 68, 0.3);
    color: white;
}

.btn-sm {
    padding: var(--space-1) var(--space-2);
    font-size: 0.75rem;
}
</style>
{% endblock %}